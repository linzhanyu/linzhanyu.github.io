---
layout: post
title: EFI 引导的 GPT 分区如何安装 Linux 
categories: [linux, efi, gpt, grub2]
tags: [linux, install]
fullview: false
comments: true
---

自从拆下一块硬盘给 Raspberry PI 做数据共享后, 一直想把咱的 openSUSE 装到固态硬盘中.但由于机器里有一块4T的硬盘分区表就全搞成 GPT 的了.那么也就只能使用 UEFI 来引导计算机了.
Linux使用了十几年了,从来没有这么折腾过.

## 第一波 -- 黑屏
从把 openSUSE Leap ISO 写到U盘, 从SSD硬盘划出60G的空间给将来的 Linux 系统, 开始了这次奇幻之旅.

从U盘启动计算机, 选择开始安装, 滚动了几行加载文字后, 黑屏....循环....黑屏!!!

开始以为是发行版的问题 换 Debian, Linux mint, Ubuntu 均是类似问题.

这看起来是个通病了, 由于一直以为是4T硬盘和GPT分区搞怪, 把所有的硬盘都拔了,问题依旧(当然了问题出在了显卡)

为什么以前在安装Linux的时候那么顺利,现在就这种样的问题呢?

开始回忆到底都有哪些硬件改动.

>1. 之前用的是 AMD 的 HD5770, 去年烧掉了,换了AMD R9.但后来重装了显卡驱动后,当时的系统也能正常工作.
>2. 加了4T的硬盘, 把所有分区表都升级成 GPT, 并使用 EFI 引导.

实在没有什么办法, 找Google帮忙吧.

啊哈~有类似的问题 需要在 Grub 的时候添加参数  **nomodeset** 来禁用加载显卡驱动

尝试 ... 

果然有变化. 看起来禁止加载 radeon 驱动后黑屏问题是初步解决了.

但是引导文字滚动了几行后显示一些USB失败的提示, 并且找不到U盘的安装盘了. 安装依然处于失败状态,但有起色.

## 第二波 -- USB设备丢失

既然是找不到安装介质,那就实在不行用光盘吧. 刻录光盘, 启动, 添加 nomodeset, 开始 ...

果然可以正常安装,不过需要全键盘操作,(还好键盘是PS/2)接口的, 鼠标是USB接口的, 暂时还是不能工作.

## 第三波 -- 光盘安装终于成功启动后USB设备无效

安装完成后发现 网卡 / USB 设备都不工作. 顿时感觉到不开心有没有!!!

继续 Google !!!

GREAT! EFI 引导时 需要在主板BIOS中设置一下 IOMMU = TRUE.. 可是咱这个 970 的主板上面并没有这个选项. 估计Linux的大神们早就遇到了这个问题, 解决方案是:
在 grub 中继续添加 **kernel 参数 IOMMU=soft**

启动 ...

啊哈~USB设备能用了.

## 第四波 -- 安装网卡/显卡驱动

这一步骤就比较正常了
lspci |grep -i eth
找到型号后，去其网下载相应的驱动程序, 通过U盘拷过来.正常编译安装.

AMD 官网下载最新的对应驱动.安装即可.

重启.

一切又是那么正常了.


## Happy Func

在用 aticonfig 生成了双显的配置后,稍加修改写到 openSUSE 的配置文件中. 重启 - **十秒开机**. 超赞!

没有尝试在U盘安装时 GRUB 中直接添加 nomodeset iommu=soft 会是什么样的反应.

后面开始装各种库,继续我在 openSUSE 上的开发之路.

